# 数据背景

##　切面详情

| 肱二头肌长头腱短轴切面 | 皮肤及皮下组织（Skin and Subcutaneous tissue，SAS）     | 三角肌（Deltoid，D）              | 肱二头肌长头腱（Long head of bicepsbrachii, LHB） | 肱骨头(Head of humerus, HH)                           |                                                      |                                                       |                                 |
| ---------------------- | ------------------------------------------------------- | --------------------------------- | ------------------------------------------------- | ----------------------------------------------------- | ---------------------------------------------------- | ----------------------------------------------------- | ------------------------------- |
| **肩胛下肌腱长轴切面** | **皮肤及皮下组织（Skin and Subcutaneous tissue，SAS）** | **三角肌（Deltoid，D）**          | **肩胛下肌腱（Subscapularis tendon, SUB）**       | **肱骨头(Head of humerus, HH)**                       |                                                      |                                                       |                                 |
| **冈上肌腱长轴切面**   | **皮肤及皮下组织（Skin and Subcutaneous tissue，SAS）** | **三角肌（Deltoid，D）**          | **肩峰下滑囊（Subacromial bursa, SCB）**          | **冈上肌腱（Supraspinatus tendon, SUP）**             | **肱骨头(Head of humerus, HH)**                      |                                                       |                                 |
| **肩关节治疗切面**     | **皮肤及皮下组织（Skin and Subcutaneous tissue，SAS）** | **三角肌（Deltoid，D）**          | **肱骨头(Head of humerus, HH)**                   | **盂唇（Glenoid labrum， GL）**                       | **关节盂（Glenoid cavity， GC）**                    | **冈下肌（Infraspinatus tendon， INF）**              |                                 |
| **腋下关节囊切面**     | **皮肤及皮下组织（Skin and Subcutaneous tissue，SAS）** | **喙肱肌（Coracobrachialis，C）** | **大圆肌（Teres major, TM）**                     | **肱二头肌短头（Short head of biceps brachii, SHB）** | **肱三头肌长头（Long head of tricepsbrachii, LHT）** | **腋下关节囊（Subaxillary articular capsule， SAC）** | **肱骨头(Head of humerus, HH)** |

## 缩写映射表

| 中文           | 英文及缩写                              |
| -------------- | --------------------------------------- |
| 皮肤及皮下组织 | （Skin and Subcutaneous tissue，SAS）   |
| 三角肌         | （Deltoid，D）                          |
| 肱二头肌长头腱 | （Long head of biceps brachii, LHB）    |
| 肱骨头         | (Head of humerus, HH)                   |
| 肩胛下肌腱     | （Subscapularis tendon, SUB）           |
| 肩峰下滑囊     | （Subacromial bursa, SCB）              |
| 冈上肌腱       | （Supraspinatus tendon, SUP）           |
| 盂唇           | （Glenoid labrum， GL）                 |
| 关节盂         | （Glenoid cavity， GC）                 |
| 冈下肌         | （Infraspinatus tendon， INF）          |
| 喙肱肌         | （Coracobrachialis，C）                 |
| 大圆肌         | （Teres major, TM）                     |
| 肱二头肌短头   | （Short head of biceps brachii, SHB）   |
| 肱三头肌长头   | （Long head of triceps brachii, LHT）   |
| 腋下关节囊     | （Subaxillary articular capsule， SAC） |

# 11月17日实验记录

## 数据集情况

**总数：740张**

**共5个切面，有效类别11**

| class      | pixs          | pixs_frequent | num      | num_frequent |
| ---------- | ------------- | ------------- | -------- | ------------ |
| background | 428414522     | 74.50%        | 740      | 17.29%       |
| SAS        | 28806836      | 5.01%         | 740      | 17.29%       |
| LHB        | 923976        | 0.16%         | 194      | 4.53%        |
| D          | 53574251      | 9.32%         | 739      | 17.27%       |
| HH         | 35137316      | 6.11%         | 732      | 17.11%       |
| SUB        | 4911119       | 0.85%         | 159      | 3.72%        |
| SUP        | 5293877       | 0.92%         | 179      | 4.18%        |
| GL         | 821770        | 0.14%         | 205      | 4.79%        |
| GC         | 4194811       | 0.73%         | 207      | 4.84%        |
| SCB        | 700838        | 0.12%         | 178      | 4.16%        |
| INF        | 12250804      | 2.13%         | 206      | 4.81%        |
| **SUM**    | **575030120** | **1**         | **4279** | **1**        |

## mmsegmentation

#### 配置

| 配置文件                                     | backbone                   | decode_head            | auxiliary_head | loss | bz   | lr_schedule | optim                  | max_iters |
| -------------------------------------------- | -------------------------- | ---------------------- | -------------- | ---- | ---- | ----------- | ---------------------- | --------- |
| deeplabv3plus_r50-d8_512x512_20k_voc12aug.py | ResNetV1c(3*3卷积替换7\*7) | deeplabv3puls(dwsASPP) | FCNHead        | ce   | 4    | poly        | SGD(lr=0.01,wd=0.0005) | 2000      |

#### data pipeline

- RomdomScaleResize
- RandomCrop
- RodomFlip
- PhotoMetricDistortion

#### 最优结果

| metric\classes | backgorund(0) | C(1)     | GL(2) | SAC(3)   | SUP(4) | INF(5) | LHF(6) | HH(7) | SCB(8) | SHB(9) | SAS   |
| -------------- | ------------- | -------- | ----- | -------- | ------ | ------ | ------ | ----- | ------ | ------ | ----- |
| **iou**        | 95.88         | 92.48    | 79.60 | 78.26    | 63.25  | 57.96  | 65.57  | 70.22 | 37.41  | 93.35  | 91.74 |
| **Acc**        | 98.28         | 95.84    | 89.68 | 84.81    | 79.95  | 67.28  | 80.62  | 82.03 | 44.56  | 96.98  | 95.59 |
| **mIou**       | 75.06         | **mAcc** | 83.24 | **aAcc** | 96.42  |        |        |       |        |        |       |

## SkmtSeg

## 实验一

#### data pipeline

-   RandomHorizontalFlip
-      RandomScaleCrop
-   RandomGaussianBlur
-   Normalize


#### 配置

| 日志文件                    | backbone | decode_head   | auxiliary_head | loss | lr_schedule | optim                  | max_epoch |
| --------------------------- | -------- | ------------- | -------------- | ---- | ----------- | ---------------------- | --------- |
| deeplab_resnet              | resnet50 | deeplabv3plus | None           | ce   | poly        | SGD(lr=0.01,wd=0.0005) | 200       |
| lr0.004_bz42020-11-17_00:21 |          |               |                |      |             |                        |           |

#### 最优结果

| metric\classes | backgorund(0) | C(1)     | GL(2) | SAC(3)   | SUP(4) | INF(5) | LHF(6) | HH(7) | SCB(8) | SHB(9) | SAS   |
| -------------- | ------------- | -------- | ----- | -------- | ------ | ------ | ------ | ----- | ------ | ------ | ----- |
| **iou**        | 93.45         | 90.48    | 70.37 | 91.41    | 79.56  | 74.58  | 79.33  | 61.86 | 68.52  | 50.59  | 91.40 |
| **Acc**        | 95.54         | 98.50    | 95.45 | 96.64    | 88.33  | 88.59  | 90.14  | 89.58 | 88.34  | 85.55  | 98.39 |
| **F1**         | 96.61         | 95.00    | 82.61 | 95.51    | 88.62  | 85.44  | 88.47  | 76.43 | 81.32  | 67.19  | 95.51 |
| **mIou**       | 77.41         | **mAcc** | G     | **OAcc** | 95.00  |        |        |       |        |        |       |


## 实验二（增加辅助分支)

#### 配置

| 日志文件                    | backbone | decode_head   | auxiliary_head | loss | bz   | lr_schedule | optim                  | max_epoch |
| --------------------------- | -------- | ------------- | -------------- | ---- | ---- | ----------- | ---------------------- | --------- |
| deeplab_resnet_fcn          | resnet50 | deeplabv3plus | simple_fcn     | ce   | 4    | poly        | SGD(lr=0.01,wd=0.0005) | 200       |
| lr0.004_bz42020-11-16_19:03 |          |               |                |      |      |             |                        |           |

#### 最优结果

| metric\classes | backgorund(0) | C(1)     | GL(2) | SAC(3)   | SUP(4) | INF(5) | LHF(6) | HH(7) | SCB(8) | SHB(9) | SAS   |
| -------------- | ------------- | -------- | ----- | -------- | ------ | ------ | ------ | ----- | ------ | ------ | ----- |
| **iou**        | 93.77         | 90.93    | 64.34 | 91.66    | 80.92  | 77.53  | 81.23  | 63.20 | 69.52  | 51.43  | 91.60 |
| **Acc**        | 95.57         | 98.41    | 96.59 | 96.91    | 89.26  | 87.99  | 90.69  | 90.14 | 90.75  | 84.58  | 98.01 |
| **F1**         | 96.78         | 95.25    | 78.30 | 95.65    | 89.45  | 87.34  | 89.65  | 77.45 | 82.02  | 67.93  | 95.61 |
| **mIou**       | 78.07         | **mAcc** | 92.65 | **aAcc** | 95.27  |        |        |       |        |        |       |

## 实验三(增加深度可分离卷积)

#### 配置

| 日志文件                    | backbone | decode_head   | auxiliary_head | loss | lr_schedule | optim                  | max_epoch |
| :-------------------------- | -------- | ------------- | -------------- | ---- | ----------- | ---------------------- | --------- |
| deeplab_resnet_fcn_dws      | resnet50 | deeplabv3plus | simple_fcn     | ce   | poly        | SGD(lr=0.01,wd=0.0005) | 200       |
| lr0.004_bz42020-11-17_10:46 |          | dwsASPP       |                |      |             |                        |           |
|                             |          |               |                |      |             |                        |           |


#### 最优结果

| metric\classes | backgorund(0) | C(1)     | GL(2) | SAC(3)   | SUP(4) | INF(5) | LHF(6) | HH(7) | SCB(8) | SHB(9) | SAS   |
| -------------- | ------------- | -------- | ----- | -------- | ------ | ------ | ------ | ----- | ------ | ------ | ----- |
| **iou**        | 93.78         | 91.24    | 68.56 | 91.81    | 81.12  | 73.59  | 77.14  | 60.66 | 69.90  | 51.70  | 91.80 |
| **Acc**        | 95.60         | 98.48    | 96.49 | 96.96    | 90.24  | 85.22  | 91.44  | 92.49 | 90.85  | 84.81  | 97.43 |
| **F1**         | 96.68         | 94.97    | 83.51 | 95.73    | 89.06  | 85.14  | 87.33  | 76.42 | 81.33  | 68.63  | 95.92 |
| **mIou**       | 77.71         | **mAcc** | 92.73 | **aAcc** | 95.22  |        |        |       |        |        |       |

## 实验四（danet,自注意力机制）

#### 配置

| 日志文件                    | backbone | decode_head | auxiliary_head | loss | lr_schedule | optim                  | max_epoch |
| --------------------------- | -------- | ----------- | -------------- | ---- | ----------- | ---------------------- | --------- |
| danet_resnet_fcn_dws        | resnet50 | danet       | simple_fcn     | ce   | poly        | SGD(lr=0.01,wd=0.0005) | 200       |
| lr0.004_bz42020-11-16_17:04 |          | dwsASPP     |                |      |             |                        |           |

#### 最优结果

| metric\classes | backgorund(0) | C(1)     | GL(2) | SAC(3)   | SUP(4) | INF(5) | LHF(6) | HH(7) | SCB(8) | SHB(9) | SAS   |
| -------------- | ------------- | -------- | ----- | -------- | ------ | ------ | ------ | ----- | ------ | ------ | ----- |
| **iou**        | 93.98         | 92.15    | 76.43 | 91.69    | 80.42  | 74.25  | 80.60  | 63.67 | 72.64  | 51.68  | 92.16 |
| **Acc**        | 97.06         | 96.84    | 91.22 | 98.84    | 87.39  | 81.71  | 87.69  | 80.18 | 86.38  | 69.33  | 97.00 |
| **F1**         | 96.90         | 95.91    | 96.64 | 95.66    | 89.14  | 85.22  | 89.26  | 77.80 | 84.15  | 68.14  | 95.92 |
| **mIou**       | 78.88         | **mAcc** | 88.24 | **aAcc** | 95.44  |        |        |       |        |        |       |



## 实验五(deeplab增加focal loss)

#### 配置

| 日志文件                    | backbone | decode_head   | auxiliary_head | loss      | lr_schedule | optim                  | max_epoch |
| --------------------------- | -------- | ------------- | -------------- | --------- | ----------- | ---------------------- | --------- |
| deeplab_resnet_fcn_dws_fcn  | resnet50 | deeplabv3plus | simple_fcn     | **focal** | poly        | SGD(lr=0.01,wd=0.0005) | 200       |
| lr0.004_bz42020-11-14_14:10 |          | dwsASPP       |                |           |             |                        |           |
|                             |          |               |                |           |             |                        |           |


#### 最优结果

| metric\classes | backgorund(0) | C(1)     | GL(2) | SAC(3)   | SUP(4) | INF(5) | LHF(6) | HH(7) | SCB(8) | SHB(9) | SAS   |
| -------------- | ------------- | -------- | ----- | -------- | ------ | ------ | ------ | ----- | ------ | ------ | ----- |
| **iou**        | 89.56         | 85.17    | 30.99 | 85.86    | 73.13  | 50.32  | 56.16  | 13.22 | 42.50  | 6.61   | 79.54 |
| **Acc**        | 91.00         | 97.53    | 45.08 | 94.34    | 90.59  | 75.42  | 83.48  | 13.94 | 96.00  | 6.77   | 97.94 |
| **F1**         | 94.49         | 91.99    | 47.32 | 92.39    | 84.48  | 66.95  | 71.92  | 23.36 | 59.65  | 12.40  | 88.60 |
| **mIou**       | 55.73         | **mAcc** | 72.01 | **aAcc** | 91.00  |        |        |       |        |        |       |

**Focal Loss:$Loss(x, class) = - \alpha (1-softmax(x)[class])^{gamma} \log(softmax(x)[class])$**

## 实验六（danet+deeplab,自注意力机制）

#### 配置

| 日志文件                    | backbone | decode_head   | auxiliary_head | loss | lr_schedule | optim                  | max_epoch |
| --------------------------- | -------- | ------------- | -------------- | ---- | ----------- | ---------------------- | --------- |
| deeplabdanet_resnet_fcn_dws | resnet50 | deeplab_danet | simple_fcn     | ce   | poly        | SGD(lr=0.01,wd=0.0005) | 200       |
| lr0.004_bz42020-11-17_20:15 |          | dwsASPP       |                |      |             |                        |           |

#### 最优结果

| metric\classes | backgorund(0) | C(1)     | GL(2) | SAC(3)   | SUP(4) | INF(5) | LHF(6) | HH(7) | SCB(8) | SHB(9) | SAS   |
| -------------- | ------------- | -------- | ----- | -------- | ------ | ------ | ------ | ----- | ------ | ------ | ----- |
| **iou**        | 94.18         | 92.25    | 72.95 | 92.04    | 81.03  | 73.82  | 78.62  | 64.11 | 72.19  | 55.06  | 92.41 |
| **Acc**        | 96.87         | 97.36    | 89.25 | 96.49    | 87.86  | 83.84  | 88.41  | 83.32 | 86.98  | 73.76  | 97.53 |
| **F1**         | 97.00         | 96.11    | 84.36 | 95.86    | 89.52  | 84.94  | 88.03  | 78.13 | 83.38  | 71.02  | 96.06 |
| **mIou**       | 79.17         | **mAcc** | 89.24 | **aAcc** | 95.54  |        |        |       |        |        |       |

