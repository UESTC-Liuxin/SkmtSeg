# 数据背景

##　切面详情

| 肱二头肌长头腱短轴切面(1) | 皮肤及皮下组织（Skin and Subcutaneous tissue，SAS）     | 三角肌（Deltoid，D）              | **肱骨头(Head of humerus, HH)** | 肱二头肌长头腱（Long head of bicepsbrachii, LHB） |                                                       |                                                      |                                                       |
| ------------------------- | ------------------------------------------------------- | --------------------------------- | ------------------------------- | ------------------------------------------------- | ----------------------------------------------------- | ---------------------------------------------------- | ----------------------------------------------------- |
| **肩胛下肌腱长轴切面(2)** | **皮肤及皮下组织（Skin and Subcutaneous tissue，SAS）** | **三角肌（Deltoid，D）**          | **肱骨头(Head of humerus, HH)** | **肩胛下肌腱（Subscapularis tendon, SUB）**       |                                                       |                                                      |                                                       |
| **腋下关节囊切面(3)**     | **皮肤及皮下组织（Skin and Subcutaneous tissue，SAS）** | **喙肱肌（Coracobrachialis，C）** | **肱骨头(Head of humerus, HH)** | **大圆肌（Teres major, TM）**                     | **肱二头肌短头（Short head of biceps brachii, SHB）** | **肱三头肌长头（Long head of tricepsbrachii, LHT）** | **腋下关节囊（Subaxillary articular capsule， SAC）** |
| **冈上肌腱长轴切面(4)**   | **皮肤及皮下组织（Skin and Subcutaneous tissue，SAS）** | **三角肌（Deltoid，D）**          | **肱骨头(Head of humerus, HH)** | **肩峰下滑囊（Subacromial bursa, SCB）**          | **冈上肌腱（Supraspinatus tendon, SUP）**             |                                                      |                                                       |
| **肩关节治疗切面(5)**     | **皮肤及皮下组织（Skin and Subcutaneous tissue，SAS）** | **三角肌（Deltoid，D）**          | **肱骨头(Head of humerus, HH)** | **盂唇（Glenoid labrum， GL）**                   | **关节盂（Glenoid cavity， GC）**                     | **冈下肌（Infraspinatus tendon， INF）**             |                                                       |

## 缩写映射表

| 中文           | 英文及缩写                              |
| -------------- | --------------------------------------- |
| 皮肤及皮下组织 | （Skin and Subcutaneous tissue，SAS）   |
| 三角肌         | （Deltoid，D）                          |
| 肱二头肌长头腱 | （Long head of biceps brachii, LHB）    |
| 肱骨头         | (Head of humerus, HH)                   |
| 肩胛下肌腱     | （Subscapularis tendon, SUB）           |
| 肩峰下滑囊     | （Subacromial bursa, SCB）              |
| 冈上肌腱       | （Supraspinatus tendon, SUP）           |
| 盂唇           | （Glenoid labrum， GL）                 |
| 关节盂         | （Glenoid cavity， GC）                 |
| 冈下肌         | （Infraspinatus tendon， INF）          |
| 喙肱肌         | （Coracobrachialis，C）                 |
| 大圆肌         | （Teres major, TM）                     |
| 肱二头肌短头   | （Short head of biceps brachii, SHB）   |
| 肱三头肌长头   | （Long head of triceps brachii, LHT）   |
| 腋下关节囊     | （Subaxillary articular capsule， SAC） |

# 11月17日实验记录

## 数据集情况

**总数：740张**

**共5个切面，有效类别11**

| class      | pixs          | pixs_frequent | num      | num_frequent |
| ---------- | ------------- | ------------- | -------- | ------------ |
| background | 428414522     | 74.50%        | 740      | 17.29%       |
| SAS        | 28806836      | 5.01%         | 740      | 17.29%       |
| LHB        | 923976        | 0.16%         | 194      | 4.53%        |
| D          | 53574251      | 9.32%         | 739      | 17.27%       |
| HH         | 35137316      | 6.11%         | 732      | 17.11%       |
| SUB        | 4911119       | 0.85%         | 159      | 3.72%        |
| SUP        | 5293877       | 0.92%         | 179      | 4.18%        |
| GL         | 821770        | 0.14%         | 205      | 4.79%        |
| GC         | 4194811       | 0.73%         | 207      | 4.84%        |
| SCB        | 700838        | 0.12%         | 178      | 4.16%        |
| INF        | 12250804      | 2.13%         | 206      | 4.81%        |
| **SUM**    | **575030120** | **1**         | **4279** | **1**        |

## mmsegmentation

#### 配置

| 配置文件                                     | backbone                   | decode_head            | auxiliary_head | loss | bz   | lr_schedule | optim                  | max_iters |
| -------------------------------------------- | -------------------------- | ---------------------- | -------------- | ---- | ---- | ----------- | ---------------------- | --------- |
| deeplabv3plus_r50-d8_512x512_20k_voc12aug.py | ResNetV1c(3*3卷积替换7\*7) | deeplabv3puls(dwsASPP) | FCNHead        | ce   | 4    | poly        | SGD(lr=0.01,wd=0.0005) | 2000      |

#### data pipeline

- RomdomScaleResize
- RandomCrop
- RodomFlip
- PhotoMetricDistortion

#### 最优结果

## 

# 11月26日实验记录

## 数据集情况

**总数：782张**

**共5个切面，有效类别11**

| class      | pixs          | pixs_frequent | num     | num_frequent |
| ---------- | ------------- | ------------- | ------- | ------------ |
| background | 447428212     | 0.74211078    | 782     | 0.17         |
| SAS        | 30669443      | 0.050868773   | 782     | 0.17         |
| LHB        | 923976        | 0.00153252    | 194     | 0.04         |
| D          | 56022133      | 0.092919105   | 781     | 0.17         |
| HH         | 36435868      | 0.060433048   | 774     | 0.17         |
| SUB        | 4911119       | 0.008145652   | 159     | 0.03         |
| SUP        | 5293877       | 0.008780499   | 179     | 0.04         |
| GL         | 1005469       | 0.001667685   | 246     | 0.05         |
| GC         | 5017141       | 0.008321501   | 249     | 0.05         |
| SCB        | 700838        | 0.00116242    | 178     | 0.04         |
| INF        | 14504891      | 0.024058018   | 248     | 0.05         |
| **SUM**    | **602912967** | **1**         | **675** | **0.98**     |



## SkmtSeg

## 实验一 (Deeplab+danet)

#### data pipeline

-      RandomScaleCrop
-   Normalize

#### 配置

| backbone | decode_head   | auxiliary_head | loss | lr_schedule | optim                   | max_epoch |
| :------- | ------------- | -------------- | ---- | ----------- | ----------------------- | --------- |
| resnet50 | deeplab_danet | fcn            | ce   | setp=30     | SGD(lr=0.004,wd=0.0005) | 100       |

#### 最优结果

| metric\classes | backgorund(0) | SAS(1)   | LHB(2) | D(3)     | HH(4) | SUB(5) | SUP(6) | GL(7) | GC(8) | SCB(9) | INF(10) |
| -------------- | ------------- | -------- | ------ | -------- | ----- | ------ | ------ | ----- | ----- | ------ | ------- |
| **Acc**        | 0.958         | 0.944    | 0.69   | 0.886    | 0.846 | 0.395  | 0.621  | 0.778 | 0.938 | 0.112  | 0.95    |
| **iou**        | 0.922         | 0.893    | 0.469  | 0.841    | 0.714 | 0.309  | 0.261  | 0.571 | 0.678 | 0.07   | 0.846   |
| **mIou**       | 0.598         | **mAcc** | 0.738  | **aAcc** | 0.929 |        |        |       |       |        |         |



## 实验二(Deeplab+non_local)

#### 配置

| backbone | decode_head | auxiliary_head | loss | lr_schedule | optim                   | max_epoch |
| :------- | ----------- | -------------- | ---- | ----------- | ----------------------- | --------- |
| resnet50 | unet        | fcn            | ce   | setp=30     | SGD(lr=0.004,wd=0.0005) | 100       |


#### 最优结果

| metric\classes | backgorund(0) | SAS(1)   | LHB(2) | D(3)     | HH(4) | SUB(5) | SUP(6) | GL(7) | GC(8) | SCB(9) | INF(10) |
| -------------- | ------------- | -------- | ------ | -------- | ----- | ------ | ------ | ----- | ----- | ------ | ------- |
| **Acc**        | 0.953         | 0.938    | 0.589  | 0.92     | 0.865 | 0.356  | 0.679  | 0.815 | 0.954 | 0.086  | 0.948   |
| **iou**        | 0.923         | 0.901    | 0.396  | 0.85     | 0.73  | 0.29   | 0.298  | 0.536 | 0.609 | 0.063  | 0.812   |
| **mIou**       | 0.583         | **mAcc** | 0.737  | **aAcc** | 0.931 |        |        |       |       |        |         |

## 实验三(Unet)

#### 配置

| backbone | decode_head | auxiliary_head | loss | lr_schedule | optim                   | max_epoch |
| :------- | ----------- | -------------- | ---- | ----------- | ----------------------- | --------- |
| resnet50 | unet        | fcn            | ce   | setp=30     | SGD(lr=0.004,wd=0.0005) | 100       |


#### 最优结果

| metric\classes | backgorund(0) | SAS(1)   | LHB(2) | D(3)     | HH(4) | SUB(5) | SUP(6) | GL(7) | GC(8) | SCB(9) | INF(10) |
| -------------- | ------------- | -------- | ------ | -------- | ----- | ------ | ------ | ----- | ----- | ------ | ------- |
| **Acc**        | 0.958         | 0.944    | 0.69   | 0.886    | 0.846 | 0.395  | 0.621  | 0.778 | 0.938 | 0.112  | 0.95    |
| **iou**        | 0.922         | 0.893    | 0.469  | 0.841    | 0.714 | 0.309  | 0.261  | 0.571 | 0.678 | 0.07   | 0.846   |
| **mIou**       | 0.598         | **mAcc** | 0.738  | **aAcc** | 0.929 |        |        |       |       |        |         |

## 实验四(unet+DAnet)

#### 配置

| backbone | decode_head | auxiliary_head | loss | lr_schedule | optim                   | max_epoch |
| :------- | ----------- | -------------- | ---- | ----------- | ----------------------- | --------- |
| resnet50 | unet_danet  | fcn            | ce   | poly        | SGD(lr=0.004,wd=0.0005) | 100       |


#### 最优结果

| metric\classes | backgorund(0) | SAS(1)   | LHB(2) | D(3)     | HH(4) | SUB(5) | SUP(6) | GL(7) | GC(8) | SCB(9) | INF(10) |
| -------------- | ------------- | -------- | ------ | -------- | ----- | ------ | ------ | ----- | ----- | ------ | ------- |
| **Acc**        | 0.963         | 0.937    | 0.595  | 0.897    | 0.833 | 0.506  | 0.312  | 0.833 | 0.904 | 0.07   | 0.941   |
| **iou**        | 0.923         | 0.904    | 0.426  | 0.848    | 0.718 | 0.333  | 0.178  | 0.599 | 0.621 | 0.05   | 0.83    |
| **mIou**       | 0.585         | **mAcc** | 0.708  | **aAcc** | 0.931 |        |        |       |       |        |         |

## 实验五（unet2+）

#### 配置

| backbone | decode_head | auxiliary_head | loss | lr_schedule | optim                   | max_epoch |
| :------- | ----------- | -------------- | ---- | ----------- | ----------------------- | --------- |
| resnet50 | unet_nested | fcn            | ce   | setp=30     | SGD(lr=0.004,wd=0.0005) | 100       |


#### 最优结果

| metric\classes | backgorund(0) | SAS(1)   | LHB(2) | D(3)     | HH(4) | SUB(5) | SUP(6) | GL(7) | GC(8) | SCB(9) | INF(10) |
| -------------- | ------------- | -------- | ------ | -------- | ----- | ------ | ------ | ----- | ----- | ------ | ------- |
| **Acc**        | 0.969         | 0.944    | 0.502  | 0.892    | 0.811 | 0.453  | 0.546  | 0.793 | 0.796 | 0.099  | 0.959   |
| **iou**        | 0.924         | 0.902    | 0.429  | 0.847    | 0.72  | 0.37   | 0.311  | 0.529 | 0.588 | 0.078  | 0.822   |
| **mIou**       | 0.593         | **mAcc** | 0.722  | **aAcc** | 0.932 |        |        |       |       |        |         |

## 实验六（unet2+ DAnet(中间）

#### 配置

| backbone | decode_head | auxiliary_head | loss | lr_schedule | optim                   | max_epoch |
| :------- | ----------- | -------------- | ---- | ----------- | ----------------------- | --------- |
| resnet50 | unet_nested | fcn            | ce   | setp=30     | SGD(lr=0.004,wd=0.0005) | 100       |


#### 最优结果

| metric\classes | backgorund(0) | SAS(1)   | LHB(2) | D(3)     | HH(4) | SUB(5) | SUP(6) | GL(7) | GC(8) | SCB(9) | INF(10) |
| -------------- | ------------- | -------- | ------ | -------- | ----- | ------ | ------ | ----- | ----- | ------ | ------- |
| **Acc**        | 0.964         | 0.934    | 0.598  | 0.897    | 0.841 | 0.453  | 0.384  | 0.685 | 0.909 | 0.071  | 0.931   |
| **iou**        | 0.924         | 0.898    | 0.457  | 0.846    | 0.73  | 0.312  | 0.211  | 0.574 | 0.613 | 0.055  | 0.802   |
| **mIou**       | 0.584         | **mAcc** | 0.697  | **aAcc** | 0.931 |        |        |       |       |        |         |

## 实验七（unet2+ non_local(中间）

#### 配置

| backbone | decode_head | auxiliary_head | loss | lr_schedule | optim                   | max_epoch |
| :------- | ----------- | -------------- | ---- | ----------- | ----------------------- | --------- |
| resnet50 | unet_nested | fcn            | ce   | setp=30     | SGD(lr=0.004,wd=0.0005) | 100       |


#### 最优结果

| metric\classes | backgorund(0) | SAS(1)   | LHB(2) | D(3)     | HH(4) | SUB(5) | SUP(6) | GL(7) | GC(8) | SCB(9) | INF(10) |
| -------------- | ------------- | -------- | ------ | -------- | ----- | ------ | ------ | ----- | ----- | ------ | ------- |
| **Acc**        | 0.965         | 0.934    | 0.383  | 0.904    | 0.856 | 0.375  | 0.319  | 0.765 | 0.79  | 0.083  | 0.899   |
| **iou**        | 0.921         | 0.901    | 0.35   | 0.851    | 0.718 | 0.299  | 0.198  | 0.615 | 0.647 | 0.06   | 0.843   |
| **mIou**       | 0.582         | **mAcc** | 0.661  | **aAcc** | 0.931 |        |        |       |       |        |         |

## 实验八（unet2+ poly）

#### 配置

```
augm = au.Augment()
sample = augm(sample)
composed_transforms = transforms.Compose([
    #tr.RandomHorizontalFlip(),
    # tr.RandomScaleCrop(base_size=self.args.image_size, crop_size=self.args.crop_size),
    tr.FixedResize(self.args.crop_size),
    #tr.RandomGaussianBlur(),
    #resnet
    tr.Normalize(mean=(0.485, 0.456, 0.406), std=(0.229, 0.224, 0.225)),
    #tr.Normalize(mean=(0.318, 0.318, 0.316), std=(0.114, 0.114, 0.115)),
    tr.ToTensor()]
    )
```

| backbone | decode_head | auxiliary_head | loss | lr_schedule | optim                   | max_epoch |
| :------- | ----------- | -------------- | ---- | ----------- | ----------------------- | --------- |
| resnet50 | unet_nested | fcn            | ce   | poly        | SGD(lr=0.004,wd=0.0005) | 100       |


#### 最优结果

| metric\classes | backgorund(0) | SAS(1)   | LHB(2) | D(3)     | HH(4) | SUB(5) | SUP(6) | GL(7) | GC(8) | SCB(9) | INF(10) |
| -------------- | ------------- | -------- | ------ | -------- | ----- | ------ | ------ | ----- | ----- | ------ | ------- |
| **Acc**        | 0.958         | 0.958    | 0.44   | 0.871    | 0.871 | 0.43   | 0.473  | 0.672 | 0.893 | 0.107  | 0.919   |
| **iou**        | 0.917         | 0.892    | 0.379  | 0.833    | 0.703 | 0.359  | 0.273  | 0.556 | 0.634 | 0.083  | 0.838   |
| **mIou**       | 0.588         | **mAcc** | 0.69   | **aAcc** | 0.927 |        |        |       |       |        |         |

## 实验九（unet2+ poly+no_aug）

```
# augm = au.Augment()
# sample = augm(sample)
composed_transforms = transforms.Compose([
    tr.RandomHorizontalFlip(),
    tr.RandomScaleCrop(base_size=self.args.image_size, crop_size=self.args.crop_size),
    # tr.FixScaleCrop(crop_size=self.args.crop_size),
    tr.RandomRotate(10),
    # tr.RandomGaussianBlur(),
    tr.Normalize(mean=(0.485, 0.456, 0.406), std=(0.229, 0.224, 0.225)),
    tr.ToTensor()]
)
```

#### 配置

| backbone | decode_head | auxiliary_head | loss | lr_schedule | optim                   | max_epoch |
| :------- | ----------- | -------------- | ---- | ----------- | ----------------------- | --------- |
| resnet50 | unet_2plus  | fcn            | ce   | poly        | SGD(lr=0.004,wd=0.0005) | 100       |


#### 最优结果

| metric\classes | backgorund(0) | SAS(1)   | LHB(2) | D(3)     | HH(4) | SUB(5) | SUP(6) | GL(7) | GC(8) | SCB(9) | INF(10) |
| -------------- | ------------- | -------- | ------ | -------- | ----- | ------ | ------ | ----- | ----- | ------ | ------- |
| **Acc**        | 0.966         | 0.957    | 0.547  | 0.93     | 0.863 | 0.289  | 0.489  | 0.804 | 0.927 | 0.027  | 0.944   |
| **iou**        | 0.934         | 0.916    | 0.505  | 0.873    | 0.752 | 0.225  | 0.219  | 0.641 | 0.717 | 0.021  | 0.897   |
| **mIou**       | 0.609         | **mAcc** | 0.704  | **aAcc** | 0.94  |        |        |       |       |        |         |

## 实验十（unet2+ danet_sc(3个)）

```
X_10 = self.head1(x[5])          	# 64*256*256
X_20 = self.head2(x[3])           	# 256*128*128
X_30 = self.head3(x[2])             # 512*64*64
X_40 = x[0]							# 1024*32*32
```

#### 配置

| backbone | decode_head | auxiliary_head | loss | lr_schedule | optim                   | max_epoch | Bathsize | size |
| :------- | ----------- | -------------- | ---- | ----------- | ----------------------- | --------- | -------- | ---- |
| resnet50 | unet_2plus  | fcn            | ce   | poly        | SGD(lr=0.004,wd=0.0005) | 100       | 2        | 448  |


#### 最优结果

| metric\classes | backgorund(0) | SAS(1)   | LHB(2) | D(3)     | HH(4) | SUB(5) | SUP(6) | GL(7) | GC(8) | SCB(9) | INF(10) |
| -------------- | ------------- | -------- | ------ | -------- | ----- | ------ | ------ | ----- | ----- | ------ | ------- |
| **Acc**        | 0.962         | 0.967    | 0.533  | 0.897    | 0.853 | 0.449  | 0.581  | 0.81  | 0.928 | 0.223  | 0.947   |
| **iou**        | 0.925         | 0.895    | 0.403  | 0.856    | 0.733 | 0.382  | 0.344  | 0.634 | 0.607 | 0.145  | 0.858   |
| **mIou**       | 0.617         | **mAcc** | 0.741  | **aAcc** | 0.935 |        |        |       |       |        |         |

## 实验十一（unet2+ danet_sa(2个)）

```
X_20 = self.head2(x[3])           	# 256*128*128
X_30 = self.head3(x[2])             # 512*64*64
X_10 = x[5]							# 64*256*256
X_40 = x[0]							# 1024*32*32
```

#### 配置

| backbone | decode_head | auxiliary_head | loss | lr_schedule | optim                   | max_epoch | Bathsize | size |
| :------- | ----------- | -------------- | ---- | ----------- | ----------------------- | --------- | -------- | ---- |
| resnet50 | unet_2plus  | fcn            | ce   | poly        | SGD(lr=0.004,wd=0.0005) | 100       | 2        | 448  |


#### 最优结果

| metric\classes | backgorund(0) | SAS(1)   | LHB(2) | D(3)     | HH(4) | SUB(5) | SUP(6) | GL(7) | GC(8) | SCB(9) | INF(10) |
| -------------- | ------------- | -------- | ------ | -------- | ----- | ------ | ------ | ----- | ----- | ------ | ------- |
| **Acc**        | 0.965         | 0.953    | 0.51   | 0.92     | 0.847 | 0.388  | 0.599  | 0.759 | 0.915 | 0.083  | 0.944   |
| **iou**        | 0.929         | 0.908    | 0.444  | 0.865    | 0.737 | 0.341  | 0.307  | 0.617 | 0.671 | 0.067  | 0.866   |
| **mIou**       | 0.614         | **mAcc** | 0.938  | **aAcc** | 0.717 |        |        |       |       |        |         |

## 实验十一（unet2+ deep_super_version）

#### 配置

| backbone | decode_head | auxiliary_head | loss | lr_schedule | optim                   | max_epoch | Bathsize | size |
| :------- | ----------- | -------------- | ---- | ----------- | ----------------------- | --------- | -------- | ---- |
| resnet50 | unet_2plus  | fcn            | ce   | poly        | SGD(lr=0.004,wd=0.0005) | 100       | 4        | 448  |


#### 最优结果

| metric\classes | backgorund(0) | SAS(1)   | LHB(2) | D(3)     | HH(4) | SUB(5) | SUP(6) | GL(7) | GC(8) | SCB(9) | INF(10) |
| -------------- | ------------- | -------- | ------ | -------- | ----- | ------ | ------ | ----- | ----- | ------ | ------- |
| **Acc**        |               |          |        |          |       |        |        |       |       |        |         |
| **iou**        |               |          |        |          |       |        |        |       |       |        |         |
| **mIou**       |               | **mAcc** |        | **aAcc** |       |        |        |       |       |        |         |

## 